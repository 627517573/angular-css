"use strict";!function(e){var r=e.module("door3.css",[]);r.config(["$logProvider",function(e){e.debugEnabled(!1)}]),r.provider("$css",[function(){var r=this.defaults={element:"link",rel:"stylesheet",type:"text/css",container:"head",method:"append",weight:0};this.$get=["$rootScope","$injector","$window","$timeout","$compile","$http","$filter","$log",function(s,n,o,i,c,u,a,f){function h(e,r,t){t&&r.hasOwnProperty("css")&&b.bind([p(r.css)],t)}function d(e,r,t){t&&b.remove(b.getFromRoute(t)),r&&b.add(b.getFromRoute(r))}function l(e,r,t,s){s&&b.remove(b.getFromState(s)),r&&b.add(b.getFromState(r))}function p(r){return r?(e.isString(r)&&(r=e.extend({href:r},N)),e.isArray(r)&&e.isString(r[0])&&e.forEach(r,function(t){r=e.extend({href:t},N)}),e.isObject(r)&&!e.isArray(r)&&(r=e.extend(r,N)),e.isArray(r)&&e.isObject(r[0])&&e.forEach(r,function(t){r=e.extend(t,N)}),r):void 0}function y(e){if(!e)return f.error("No stylesheets provided");var r="?cache=";-1===e.href.indexOf(r)&&(e.href=e.href+(e.bustCache?r+(new Date).getTime():""))}function m(e,r){return e&&r?a("filter")(e,function(e){return e[r]}):f.error("filterBy: missing array or property")}function v(e){return e?(F[e.href]=o.matchMedia(e.media),A[e.href]=function(r){i(function(){if(r.matches)s.stylesheets.push(e);else{var t=s.stylesheets.indexOf(a("filter")(s.stylesheets,{href:e.href})[0]);-1!==t&&s.stylesheets.splice(t,1)}})},F[e.href].addListener(A[e.href]),void A[e.href](F[e.href])):f.error("No stylesheet provided")}function g(r){return r?void(s&&e.isDefined(F)&&F[r.href]&&e.isDefined(A)&&F[r.href].removeListener(A[r.href])):f.error("No stylesheet provided")}function $(e){return e?!(!e.media||-1!==S.indexOf(e.media)||!o.matchMedia):f.error("No stylesheet provided")}var b={},E='<link ng-repeat="stylesheet in stylesheets track by $index | orderBy: \'weight\' " rel="{{ stylesheet.rel }}" type="{{ stylesheet.type }}" ng-href="{{ stylesheet.href }}" ng-attr-media="{{ stylesheet.media }}">',F={},A={},S=["print"],N=e.extend({},r),w=e.element(document.querySelector?document.querySelector(N.container):document.getElementsByTagName(N.container)[0]);return e.forEach(t,function(e,r){e.hasOwnProperty("css")&&(t[r]=p(e.css))}),s.stylesheets=[],w[N.method](c(E)(s)),s.$on("$directiveAdd",h),s.$on("$routeChangeStart",d),s.$on("$stateChangeStart",l),b.getFromRoute=function(r){if(!r)return f.error("Get From Route: No route provided");var t=null,s=[];return r.$$route&&r.$$route.css?t=r.$$route.css:r.css&&(t=r.css),t&&(e.isArray(t)?e.forEach(t,function(e){s.push(p(e))}):s.push(p(t))),s},b.getFromRoutes=function(r){if(!r)return f.error("Get From Routes: No routes provided");var t=[];return e.forEach(r,function(e){var r=b.getFromRoute(e);r.length&&t.push(r[0])}),t},b.getFromState=function(r){if(!r)return f.error("Get From State: No state provided");var t=[];return e.isDefined(r.views)&&e.forEach(r.views,function(e){e.css&&t.push(p(e.css))}),e.isDefined(r.children)&&e.forEach(r.children,function(r){r.css&&t.push(p(r.css)),e.isDefined(r.children)&&e.forEach(r.children,function(e){e.css&&t.push(p(e.css))})}),e.isDefined(r.css)&&(e.isArray(r.css)?e.forEach(r.css,function(e){t.push(p(e))}):t.push(p(r.css))),t},b.getFromStates=function(r){if(!r)return f.error("Get From States: No states provided");var t=[];return e.forEach(r,function(r){var s=b.getFromState(r);e.isArray(s)?e.forEach(s,function(e){t.push(e)}):t.push(s)}),t},b.preload=function(r,s){r||(r=[],t.length&&Array.prototype.push.apply(r,t),n.has("$route")&&Array.prototype.push.apply(r,b.getFromRoutes(n.get("$route").routes)),n.has("$state")&&Array.prototype.push.apply(r,b.getFromStates(n.get("$state").get()))),r=m(r,"preload"),e.forEach(r,function(t,n){u.get(t.href).success(function(t){f.debug("preload response: "+t),r.length===n+1&&e.isFunction(s)&&s(r)}).error(function(){f.error("Incorrect path for "+t.href)})})},b.bind=function(r,t){if(!r||!t)return f.error("No scope or stylesheets provided");var s=[];e.isArray(r)?e.forEach(r,function(e){s.push(p(e))}):s.push(p(r)),b.add(s),f.debug("$css.bind(): Added",s),t.$on("$destroy",function(){b.remove(s),f.debug("$css.bind(): Removed",s)})},b.add=function(r){return r?(e.isArray(r)||(r=[r]),e.forEach(r,function(e){e=p(e),e.href&&!a("filter")(s.stylesheets,{href:e.href}).length&&(y(e),$(e)?v(e):s.stylesheets.push(e),f.debug("$css.add(): "+e.href))}),void s.$broadcast("$cssAdd",r,s.stylesheets)):f.error("No stylesheets provided")},b.remove=function(r){return r?(r=a("filter")(r,function(e){return!e.persist}),e.forEach(r,function(e){var r=s.stylesheets.indexOf(a("filter")(s.stylesheets,{href:e.href})[0]);-1!==r&&s.stylesheets.splice(r,1),g(e),f.debug("$css.remove(): "+e.href)}),void s.$broadcast("$cssRemove",r,s.stylesheets)):f.error("No stylesheets provided")},b.removeAll=function(){s&&s.hasOwnProperty("stylesheets")&&(s.stylesheets.length=0),f.debug("all stylesheets removed")},b.preload(),b}]}]),r.filter("$cssLinks",function(){return function(r){if(!r||!e.isArray(r))return r;var t="";return e.forEach(r,function(e){t+='<link rel="'+e.rel+'" type="'+e.type+'" href="'+e.href+'"',t+=e.media?' media="'+e.media+'"':"",t+=">\n\n"}),t}}),r.run(["$css",function(){}]);var t=[],s=e.module;e.module=function(){var r=s.apply(this,arguments),n=r.directive;return r.directive=function(r,s){var o=e.isFunction(s)?s:s[s.length-1];try{var i=e.copy(o)();i.directiveName=r,i.hasOwnProperty("css")&&t.push(i)}catch(c){}return n.apply(this,arguments)},r.config(["$provide","$injector",function(r,s){e.forEach(t,function(e){var t=e.directiveName+"Directive";s.has(t)&&r.decorator(t,["$delegate","$rootScope","$timeout",function(r,t,s){var n=r[0],o=n.compile;return n.css&&(e.css=n.css),n.compile=function(){var e=o?o.apply(this,arguments):!1;return function(r){var o=arguments;s(function(){e&&e.apply(this,o)}),t.$broadcast("$directiveAdd",n,r)}},r}])})}]),r}}(angular);